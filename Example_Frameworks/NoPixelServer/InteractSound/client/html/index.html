<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <script>
            let audioPlayer = null;

            window.addEventListener('message', (event) => {
                const data = event.data;
                if (data.transactionType === 'playSound') {
                    if (audioPlayer) { audioPlayer.pause(); }
                    audioPlayer = new Audio(`./sounds/${data.transactionFile}.ogg`);
                    audioPlayer.volume = data.transactionVolume;
                    audioPlayer.onended = () => { audioPlayer = null; };
                    audioPlayer.play();
                } else if (data.transactionType === 'playSoundFlash') {
                    if (audioPlayer) { audioPlayer.pause(); }
                    audioPlayer = new Audio(`./sounds/${data.transactionFile}.ogg`);
                    audioPlayer.volume = data.transactionVolume;
                    audioPlayer.play();

                    const start = data.transactionVolume * 100;
                    setTimeout(() => {
                        let vol = data.transactionVolume;
                        let i = start;
                        const interval = setInterval(() => {
                            if (i > 0) {
                                vol = Math.max(0.1, vol - 0.01);
                                audioPlayer.volume = vol;
                                i--;
                            } else {
                                clearInterval(interval);
                            }
                        }, data.transactionTime);
                    }, data.transactionHold);
                }
            });
        </script>
    </head>
</html>
